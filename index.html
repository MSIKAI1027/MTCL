<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ESP32 MQTT 控制介面</title>
</head>
<body>
  <h2>MQTT 控制面板</h2>

  <label for="valueInput">輸入值：</label>
  <input type="text" id="valueInput" placeholder="例如: ON 或 OFF" />
  <button onclick="sendMessage()">送出</button>

  <h3>ESP32 回傳資料：</h3>
  <pre id="esp32Response">尚未收到資料</pre>

  <!-- 引入 MQTT.js -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script>
    // 連接 MQTT broker（此範例使用 mqttgo.io 公共 broker）
    const client = mqtt.connect('wss://broker.mqttgo.io:8084/mqtt');

    const pubTopic = 'esp32/control';
    const subTopic = 'esp32/response';

    client.on('connect', () => {
      console.log('✅ 已連接 MQTT broker');
      client.subscribe(subTopic);
    });

    client.on('message', (topic, message) => {
      if (topic === subTopic) {
        document.getElementById('esp32Response').textContent = message.toString();
      }
    });

    function sendMessage() {
      const value = document.getElementById('valueInput').value;
      const jsonPayload = JSON.stringify({
        command: 'set',
        value: value
      });
      client.publish(pubTopic, jsonPayload);
    }
  </script>
</body>
</html>
